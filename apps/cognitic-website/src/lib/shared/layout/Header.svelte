<script lang="ts">
  import Divider from '../components/Divider.svelte';
  import ActivityFeedIcon from '../components/Icons/ActivityFeedIcon.svelte';
  import LogoIcon from '../components/Icons/LogoIcon.svelte';
  import { locale, locales } from 'svelte-i18n';
  import Listbox from '../components/Listbox/Listbox.svelte';
  import { settingsStore } from '$lib/features/SettingsModal/stores/settings';
  import Button from '../components/Button.svelte';
  import { _ } from 'svelte-i18n';
  import GitHubIcon from '../components/Icons/GitHubIcon.svelte';
  import AuthButton from '$lib/features/Auth/components/AuthButton.svelte';
  import { trackEvent } from '$lib/core/services/tracking';

  export let sidebarOpen = true;

  const options = settingsStore.availableRepositories;
</script>

<header class="sticky top-0 z-20" style={$$props.style}>
  <span class="bg-background-primary flex h-14 items-center px-6">
    <a href="/" class="flex items-center">
      <!-- LOGO -->
      <LogoIcon class="mr-2 h-6 w-6" />
      <!-- COGNITIC -->
      <svg
        viewBox="0 0 147 23"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-auto"
      >
        <path
          d="M12.6634 6.57022C12.5664 5.66279 12.1577 4.95624 11.4373 4.45057C10.7239 3.94491 9.79565 3.69207 8.65271 3.69207C7.84918 3.69207 7.15995 3.81329 6.58501 4.05574C6.01007 4.29818 5.57021 4.62721 5.26543 5.04283C4.96064 5.45844 4.80478 5.93294 4.79786 6.46632C4.79786 6.90964 4.8983 7.29409 5.09918 7.61965C5.30699 7.94522 5.58753 8.2223 5.9408 8.45089C6.29408 8.67255 6.68545 8.85958 7.11492 9.01197C7.54439 9.16436 7.97733 9.29251 8.41373 9.39641L10.4087 9.89515C11.2122 10.0822 11.9846 10.335 12.7258 10.6537C13.4739 10.9723 14.1423 11.3741 14.7311 11.8589C15.3268 12.3438 15.7979 12.9292 16.1442 13.6149C16.4905 14.3007 16.6637 15.1042 16.6637 16.0255C16.6637 17.2724 16.3451 18.3703 15.7078 19.3193C15.0705 20.2613 14.1492 20.9991 12.9439 21.5324C11.7456 22.0589 10.2944 22.3221 8.59036 22.3221C6.93482 22.3221 5.49748 22.0658 4.27834 21.5532C3.06612 21.0406 2.11713 20.2925 1.43136 19.3089C0.752518 18.3253 0.38539 17.1269 0.329974 15.7138H4.12248C4.1779 16.455 4.40648 17.0715 4.80825 17.5633C5.21001 18.0551 5.733 18.4222 6.3772 18.6647C7.02833 18.9071 7.75566 19.0283 8.55919 19.0283C9.39735 19.0283 10.1316 18.9037 10.762 18.6543C11.3992 18.398 11.898 18.0447 12.2582 17.5945C12.6184 17.1373 12.8019 16.6039 12.8089 15.9943C12.8019 15.4402 12.6392 14.983 12.3205 14.6228C12.0019 14.2557 11.5551 13.9509 10.9802 13.7084C10.4122 13.4591 9.74716 13.2374 8.9852 13.0435L6.56423 12.42C4.81171 11.9698 3.42632 11.2875 2.40806 10.3731C1.39672 9.45183 0.891057 8.22922 0.891057 6.70529C0.891057 5.45152 1.23048 4.35359 1.90932 3.41153C2.59509 2.46947 3.52676 1.73867 4.70434 1.21915C5.88192 0.692702 7.21536 0.429478 8.70466 0.429478C10.2147 0.429478 11.5378 0.692702 12.6738 1.21915C13.8167 1.73867 14.7138 2.46254 15.3649 3.39075C16.0161 4.31203 16.352 5.37186 16.3728 6.57022H12.6634ZM27.6055 6.04031V8.94963H18.4307V6.04031H27.6055ZM20.6958 2.21663H24.4572V17.1996C24.4572 17.7053 24.5334 18.0932 24.6858 18.3634C24.8451 18.6266 25.0529 18.8067 25.3092 18.9037C25.5655 19.0006 25.8495 19.0491 26.1612 19.0491C26.3967 19.0491 26.6114 19.0318 26.8054 18.9972C27.0063 18.9625 27.1587 18.9314 27.2626 18.9037L27.8964 21.8441C27.6955 21.9134 27.408 21.9896 27.034 22.0727C26.6669 22.1559 26.2166 22.2043 25.6832 22.2182C24.7412 22.2459 23.8926 22.1039 23.1376 21.7922C22.3825 21.4736 21.7834 20.9817 21.34 20.3168C20.9036 19.6518 20.6889 18.8205 20.6958 17.823V2.21663ZM37.3471 22.3117C35.747 22.3117 34.3651 21.9792 33.2013 21.3142C32.0445 20.6423 31.1544 19.6933 30.531 18.4673C29.9076 17.2343 29.5958 15.7831 29.5958 14.1137C29.5958 12.472 29.9076 11.0312 30.531 9.79125C31.1613 8.5444 32.0411 7.57463 33.1702 6.88193C34.2992 6.18231 35.6258 5.8325 37.1497 5.8325C38.1333 5.8325 39.0615 5.99182 39.9343 6.31046C40.814 6.62217 41.5899 7.10706 42.2618 7.76512C42.9406 8.42318 43.474 9.26134 43.8619 10.2796C44.2498 11.2909 44.4438 12.4962 44.4438 13.8955V15.0488H31.3622V12.5135H40.8383C40.8314 11.7931 40.6755 11.1524 40.3707 10.5913C40.0659 10.0233 39.6399 9.57652 39.0927 9.25095C38.5524 8.92538 37.922 8.7626 37.2016 8.7626C36.4327 8.7626 35.7574 8.94963 35.1755 9.32368C34.5936 9.69081 34.1399 10.1757 33.8144 10.7783C33.4957 11.3741 33.3329 12.0287 33.326 12.7421V14.9553C33.326 15.8835 33.4957 16.6801 33.8351 17.3451C34.1746 18.0031 34.6491 18.5088 35.2586 18.8621C35.8682 19.2084 36.5817 19.3816 37.3991 19.3816C37.9463 19.3816 38.4416 19.3054 38.8849 19.153C39.3282 18.9937 39.7127 18.7617 40.0382 18.4569C40.3638 18.1521 40.6097 17.7746 40.7759 17.3243L44.2879 17.7191C44.0662 18.6474 43.6437 19.4578 43.0203 20.1505C42.4038 20.8363 41.6141 21.3696 40.6513 21.7506C39.6884 22.1247 38.587 22.3117 37.3471 22.3117ZM54.3932 22.3117C52.7931 22.3117 51.4112 21.9792 50.2474 21.3142C49.0906 20.6423 48.2005 19.6933 47.5771 18.4673C46.9537 17.2343 46.642 15.7831 46.642 14.1137C46.642 12.472 46.9537 11.0312 47.5771 9.79125C48.2074 8.5444 49.0872 7.57463 50.2163 6.88193C51.3454 6.18231 52.6719 5.8325 54.1958 5.8325C55.1794 5.8325 56.1076 5.99182 56.9804 6.31046C57.8602 6.62217 58.636 7.10706 59.3079 7.76512C59.9867 8.42318 60.5201 9.26134 60.908 10.2796C61.2959 11.2909 61.4899 12.4962 61.4899 13.8955V15.0488H48.4083V12.5135H57.8844C57.8775 11.7931 57.7216 11.1524 57.4168 10.5913C57.112 10.0233 56.686 9.57652 56.1388 9.25095C55.5985 8.92538 54.9682 8.7626 54.2477 8.7626C53.4789 8.7626 52.8035 8.94963 52.2216 9.32368C51.6398 9.69081 51.186 10.1757 50.8605 10.7783C50.5418 11.3741 50.379 12.0287 50.3721 12.7421V14.9553C50.3721 15.8835 50.5418 16.6801 50.8813 17.3451C51.2207 18.0031 51.6952 18.5088 52.3047 18.8621C52.9143 19.2084 53.6278 19.3816 54.4452 19.3816C54.9924 19.3816 55.4877 19.3054 55.931 19.153C56.3743 18.9937 56.7588 18.7617 57.0843 18.4569C57.4099 18.1521 57.6558 17.7746 57.8221 17.3243L61.334 17.7191C61.1124 18.6474 60.6898 19.4578 60.0664 20.1505C59.4499 20.8363 58.6602 21.3696 57.6974 21.7506C56.7345 22.1247 55.6331 22.3117 54.3932 22.3117ZM64.3738 22V6.04031H68.0209V8.70026H68.1871C68.4781 7.77897 68.9768 7.06896 69.6833 6.57022C70.3968 6.06455 71.2107 5.81172 72.1251 5.81172C72.3329 5.81172 72.565 5.82211 72.8213 5.84289C73.0845 5.85674 73.3027 5.88099 73.4759 5.91562V9.37563C73.3165 9.32022 73.0637 9.27173 72.7173 9.23017C72.3779 9.18168 72.0489 9.15743 71.7303 9.15743C71.0445 9.15743 70.428 9.30636 69.8808 9.60422C69.3405 9.89515 68.9145 10.3004 68.6027 10.8199C68.291 11.3394 68.1352 11.9386 68.1352 12.6174V22H64.3738ZM94.0573 7.90019H90.1713C90.0605 7.26291 89.8561 6.69837 89.5583 6.20655C89.2604 5.70781 88.8898 5.28527 88.4465 4.93892C88.0032 4.59257 87.4975 4.33281 86.9295 4.15964C86.3684 3.97954 85.7623 3.88949 85.1112 3.88949C83.9544 3.88949 82.9292 4.18042 82.0356 4.76228C81.142 5.33722 80.4424 6.18231 79.9367 7.29755C79.4311 8.40586 79.1782 9.76008 79.1782 11.3602C79.1782 12.988 79.4311 14.3596 79.9367 15.4748C80.4493 16.5831 81.1489 17.4213 82.0356 17.9893C82.9292 18.5504 83.9509 18.8309 85.1008 18.8309C85.738 18.8309 86.3338 18.7478 86.8879 18.5816C87.449 18.4084 87.9512 18.1555 88.3945 17.823C88.8448 17.4906 89.2223 17.0819 89.5271 16.597C89.8388 16.1121 90.0535 15.5579 90.1713 14.9345L94.0573 14.9553C93.9118 15.9666 93.5967 16.9156 93.1118 17.8023C92.6338 18.6889 92.0069 19.4717 91.2311 20.1505C90.4553 20.8224 89.5479 21.3489 88.5088 21.7298C87.4698 22.1039 86.3164 22.2909 85.0488 22.2909C83.1785 22.2909 81.5091 21.858 80.0406 20.9921C78.5721 20.1263 77.4153 18.8759 76.5702 17.2412C75.7251 15.6064 75.3026 13.6461 75.3026 11.3602C75.3026 9.06738 75.7286 7.10706 76.5806 5.47922C77.4326 3.84446 78.5929 2.59415 80.0614 1.72828C81.5299 0.862412 83.1924 0.429478 85.0488 0.429478C86.2333 0.429478 87.3347 0.595724 88.353 0.928218C89.3712 1.26071 90.2787 1.74906 91.0753 2.39327C91.8719 3.03055 92.5265 3.81329 93.039 4.7415C93.5586 5.66279 93.898 6.71569 94.0573 7.90019ZM104.085 22.3117C102.526 22.3117 101.175 21.9688 100.032 21.2831C98.8895 20.5973 98.0028 19.6379 97.3725 18.4049C96.749 17.1719 96.4373 15.7311 96.4373 14.0825C96.4373 12.4339 96.749 10.9896 97.3725 9.74969C98.0028 8.50976 98.8895 7.54692 100.032 6.86115C101.175 6.17538 102.526 5.8325 104.085 5.8325C105.643 5.8325 106.994 6.17538 108.137 6.86115C109.28 7.54692 110.163 8.50976 110.787 9.74969C111.417 10.9896 111.732 12.4339 111.732 14.0825C111.732 15.7311 111.417 17.1719 110.787 18.4049C110.163 19.6379 109.28 20.5973 108.137 21.2831C106.994 21.9688 105.643 22.3117 104.085 22.3117ZM104.105 19.2985C104.951 19.2985 105.657 19.0664 106.225 18.6023C106.793 18.1313 107.216 17.5009 107.493 16.7113C107.777 15.9216 107.919 15.0419 107.919 14.0721C107.919 13.0954 107.777 12.2122 107.493 11.4225C107.216 10.6259 106.793 9.99213 106.225 9.5211C105.657 9.05007 104.951 8.81455 104.105 8.81455C103.24 8.81455 102.519 9.05007 101.944 9.5211C101.376 9.99213 100.95 10.6259 100.666 11.4225C100.389 12.2122 100.251 13.0954 100.251 14.0721C100.251 15.0419 100.389 15.9216 100.666 16.7113C100.95 17.5009 101.376 18.1313 101.944 18.6023C102.519 19.0664 103.24 19.2985 104.105 19.2985ZM120.549 22.2805C119.295 22.2805 118.173 21.9584 117.182 21.3142C116.192 20.67 115.409 19.7349 114.834 18.5088C114.259 17.2827 113.972 15.7935 113.972 14.0409C113.972 12.2676 114.263 10.7714 114.845 9.55227C115.433 8.3262 116.227 7.40145 117.224 6.77803C118.221 6.14768 119.333 5.8325 120.559 5.8325C121.494 5.8325 122.263 5.99182 122.866 6.31046C123.469 6.62217 123.947 6.99969 124.3 7.44301C124.653 7.87941 124.927 8.29157 125.121 8.67948H125.277V0.72041H129.048V22H125.349V19.4855H125.121C124.927 19.8734 124.646 20.2856 124.279 20.722C123.912 21.1514 123.427 21.5186 122.824 21.8234C122.222 22.1281 121.463 22.2805 120.549 22.2805ZM121.598 19.1946C122.395 19.1946 123.074 18.9798 123.635 18.5504C124.196 18.114 124.622 17.5079 124.913 16.7321C125.204 15.9562 125.349 15.0523 125.349 14.0202C125.349 12.988 125.204 12.091 124.913 11.329C124.629 10.5671 124.206 9.97481 123.645 9.55227C123.091 9.12973 122.409 8.91845 121.598 8.91845C120.76 8.91845 120.061 9.13665 119.499 9.57305C118.938 10.0094 118.516 10.6121 118.232 11.381C117.948 12.1499 117.806 13.0296 117.806 14.0202C117.806 15.0176 117.948 15.9077 118.232 16.6905C118.523 17.4663 118.949 18.0793 119.51 18.5296C120.078 18.9729 120.774 19.1946 121.598 19.1946ZM139.824 22.3117C138.224 22.3117 136.842 21.9792 135.678 21.3142C134.521 20.6423 133.631 19.6933 133.008 18.4673C132.384 17.2343 132.073 15.7831 132.073 14.1137C132.073 12.472 132.384 11.0312 133.008 9.79125C133.638 8.5444 134.518 7.57463 135.647 6.88193C136.776 6.18231 138.102 5.8325 139.626 5.8325C140.61 5.8325 141.538 5.99182 142.411 6.31046C143.291 6.62217 144.067 7.10706 144.738 7.76512C145.417 8.42318 145.951 9.26134 146.339 10.2796C146.726 11.2909 146.92 12.4962 146.92 13.8955V15.0488H133.839V12.5135H143.315C143.308 11.7931 143.152 11.1524 142.847 10.5913C142.543 10.0233 142.117 9.57652 141.569 9.25095C141.029 8.92538 140.399 8.7626 139.678 8.7626C138.909 8.7626 138.234 8.94963 137.652 9.32368C137.07 9.69081 136.617 10.1757 136.291 10.7783C135.972 11.3741 135.81 12.0287 135.803 12.7421V14.9553C135.803 15.8835 135.972 16.6801 136.312 17.3451C136.651 18.0031 137.126 18.5088 137.735 18.8621C138.345 19.2084 139.058 19.3816 139.876 19.3816C140.423 19.3816 140.918 19.3054 141.362 19.153C141.805 18.9937 142.189 18.7617 142.515 18.4569C142.84 18.1521 143.086 17.7746 143.253 17.3243L146.765 17.7191C146.543 18.6474 146.12 19.4578 145.497 20.1505C144.88 20.8363 144.091 21.3696 143.128 21.7506C142.165 22.1247 141.064 22.3117 139.824 22.3117Z"
          fill="#FAFAFA"
        />
      </svg>
    </a>
    <div
      class="bg-background-secondaryActive text-content-primarySub label-small-plus ml-2.5 flex h-5 items-center px-2.5"
      style="font-size: 11px;"
    >
      BETA
    </div>

    <div role="separator" class="ml-4 flex-1" />
    <AuthButton />
    <!-- <div class="flex flex-1 items-center justify-end">
      <Listbox
        selected={{ label: $locale || 'unknown', value: $locale }}
        on:change={(e) => {
          locale.set(e.detail.value);
          localStorage.setItem('cognitic.locale', e.detail.value);
        }}
        options={$locales.map((l) => {
          return {
            label: l,
            value: l
          };
        })}
      />
    </div> -->
  </span>

  <Divider />

  <div class="flex h-14 flex-shrink-0 items-center px-6 md:justify-between">
    <button
      class="mr-3 block md:hidden"
      on:click={() => (sidebarOpen = !sidebarOpen)}
    >
      <ActivityFeedIcon class="h-8 w-8" />
    </button>

    <div class="flex items-center">
      <Listbox
        selected={$settingsStore.selectedRepo}
        on:change={(e) => {
          settingsStore.updateSettings({
            selectedRepo: e.detail
          });
        }}
        options={$options}
      >
        <span
          slot="selected-option-prefix"
          class="text-content-primary headline-large flex items-center capitalize"
          let:selected
        >
          <span class="mr-3">
            <GitHubIcon class="text-content-tertiary h-6 w-6" />
          </span>
          {selected.label}
        </span>
      </Listbox>

      {#if $settingsStore.selectedRepo.version}
        <div
          class="label-mini-plus flex h-5 items-center"
          style="font-size: 11px;"
        >
          <span class="text-content-primarySub">
            {$settingsStore.selectedRepo.version}
          </span>
        </div>
      {/if}
    </div>

    <Button
      variant="secondary"
      size="medium"
      as="a"
      href="https://docs.google.com/forms/d/e/1FAIpQLSei53M_VZH1LVIBygG1k_6Ifwfo_regUEiZkNfKKYKiVbnfrA/viewform"
      target="_blank"
      class="hidden md:flex"
      on:click={() => {
        trackEvent('Open Import Repo Form');
      }}
    >
      {$_('header.importRepoButton')}
    </Button>
  </div>
  <Divider />
</header>
